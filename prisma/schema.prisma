generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User roles in the system
enum UserRole {
  STARTUP
  INVESTOR
  MENTOR
  STUDENT
  ADMIN
}

enum SessionType {
  WEBINAR
  PANEL_DISCUSSION
  PRODUCT_DEMO
}

model User {
  id                    Int                 @id @default(autoincrement())
  full_name             String
  email                 String              @unique
  mobile                String?
  password_hash         String
  email_verified        Boolean             @default(false)
  otp                   String?
  otp_expires_at        DateTime?
  reset_token           String?             @unique
  reset_token_expiry    DateTime?
  is_verified           Boolean             @default(false)
  is_active             Boolean             @default(true)
  last_login            DateTime?
  created_at            DateTime            @default(now())
  updated_at            DateTime            @updatedAt
  role                  UserRole            @default(STARTUP)
  startup_profile       StartupProfile?
  student_profile       StudentProfile?
  posts                 Post[]
  likes                 Like[]
  comments              Comment[]
  sessions              Session[]
  needs                 Need[]
  notifications         Notification[]
  funding_submissions   FundingSubmission[]
  is_startup_verified   Boolean             @default(false)
  has_submitted_profile Boolean             @default(false)

  @@map("users")
}

model Post {
  id            Int            @id @default(autoincrement())
  user_id       Int
  author        User           @relation(fields: [user_id], references: [id], onDelete: Cascade)
  text          String
  images        String[]
  documents     String[]
  likes         Like[]
  comments      Comment[]
  notifications Notification[]
  published     Boolean        @default(false)
  created_at    DateTime       @default(now())
  updated_at    DateTime       @updatedAt

  @@map("posts")
}

model Like {
  id         Int      @id @default(autoincrement())
  user_id    Int
  post_id    Int
  user       User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
  post       Post     @relation(fields: [post_id], references: [id], onDelete: Cascade)
  created_at DateTime @default(now())

  @@unique([user_id, post_id])
}

// Ensures a user can like a post only once
model Comment {
  id         Int      @id @default(autoincrement())
  user_id    Int
  post_id    Int
  content    String
  user       User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
  post       Post     @relation(fields: [post_id], references: [id], onDelete: Cascade)
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
}

model StartupProfile {
  id                    Int                   @id @default(autoincrement())
  user_id               Int                   @unique
  is_complete           Boolean               @default(false)
  isTrending            Boolean               @default(false)
  isStartupOfTheWeek    Boolean               @default(false)
  completion_percentage Int                   @default(0)
  created_at            DateTime              @default(now())
  updated_at            DateTime              @updatedAt
  business_details      BusinessDetails?
  company_details       CompanyDetails?
  innovation_focus      InnovationFocus?
  interests             Interests?
  offerings             Offerings?
  partnership_interests PartnershipInterests?
  personal_info         PersonalInfo?
  user                  User                  @relation(fields: [user_id], references: [id], onDelete: Cascade)
  technology_interests  TechnologyInterests?

  @@map("startup_profiles")
}

model PersonalInfo {
  id                 Int            @id @default(autoincrement())
  startup_profile_id Int            @unique
  profile_picture    String?
  first_name         String
  last_name          String?
  email              String
  phone              String
  location           String
  website            String?
  birth_date         DateTime?
  bio                String?
  created_at         DateTime       @default(now())
  updated_at         DateTime       @updatedAt
  startup_profile    StartupProfile @relation(fields: [startup_profile_id], references: [id], onDelete: Cascade)

  @@map("personal_info")
}

model BusinessDetails {
  id                 Int            @id @default(autoincrement())
  startup_profile_id Int            @unique
  job_title          String
  company            String
  industry           String
  experience         String?
  business_type      String?
  team_size          String?
  revenue            String?
  funding_stage      String?
  skills             String?
  goals              String?
  linkedin_profile   String
  twitter_profile    String?
  github_profile     String?
  portfolio_website  String?
  created_at         DateTime       @default(now())
  updated_at         DateTime       @updatedAt
  startup_profile    StartupProfile @relation(fields: [startup_profile_id], references: [id], onDelete: Cascade)

  @@map("business_details")
}

model CompanyDetails {
  id                  Int            @id @default(autoincrement())
  startup_profile_id  Int            @unique
  company_logo        String?
  company_name        String
  founded_year        Int
  company_email       String
  company_phone       String
  company_location    String?
  company_website     String?
  company_description String?
  vision              String?
  mission             String?
  team_size           String?
  company_type        String?
  industry            String?
  revenue_range       String?
  legal_name          String?
  tax_id              String?
  registration_date   DateTime?
  business_license    String?
  created_at          DateTime       @default(now())
  updated_at          DateTime       @updatedAt
  startup_profile     StartupProfile @relation(fields: [startup_profile_id], references: [id], onDelete: Cascade)

  @@map("company_details")
}

model Offerings {
  id                    Int            @id @default(autoincrement())
  startup_profile_id    Int            @unique
  products              String[]       @default([])
  services              String[]       @default([])
  pricing_model         String?
  target_market         String?
  revenue_streams       String[]       @default([])
  partnerships          String[]       @default([])
  certifications        String[]       @default([])
  value_proposition     String?
  competitive_advantage String?
  business_model        String?
  created_at            DateTime       @default(now())
  updated_at            DateTime       @updatedAt
  startup_profile       StartupProfile @relation(fields: [startup_profile_id], references: [id], onDelete: Cascade)

  @@map("offerings")
}

model Interests {
  id                     Int            @id @default(autoincrement())
  startup_profile_id     Int            @unique
  primary_industry       String
  secondary_industry     String?
  primary_target_market  String?
  geographic_focus       String?
  market_description     String?
  partnership_goals      String?
  innovation_description String?
  future_goals           String?
  created_at             DateTime       @default(now())
  updated_at             DateTime       @updatedAt
  startup_profile        StartupProfile @relation(fields: [startup_profile_id], references: [id], onDelete: Cascade)

  @@map("interests")
}

model TechnologyInterests {
  id                  Int            @id @default(autoincrement())
  startup_profile_id  Int            @unique
  ai_ml               Boolean        @default(false)
  blockchain          Boolean        @default(false)
  cloud_computing     Boolean        @default(false)
  cybersecurity       Boolean        @default(false)
  iot                 Boolean        @default(false)
  fintech             Boolean        @default(false)
  healthtech          Boolean        @default(false)
  edtech              Boolean        @default(false)
  sustainability_tech Boolean        @default(false)
  other_tech          String?
  created_at          DateTime       @default(now())
  updated_at          DateTime       @updatedAt
  startup_profile     StartupProfile @relation(fields: [startup_profile_id], references: [id], onDelete: Cascade)

  @@map("technology_interests")
}

model PartnershipInterests {
  id                       Int            @id @default(autoincrement())
  startup_profile_id       Int            @unique
  startup_partnerships     Boolean        @default(false)
  enterprise_partnerships  Boolean        @default(false)
  research_collaborations  Boolean        @default(false)
  academic_partnerships    Boolean        @default(false)
  government_contracts     Boolean        @default(false)
  nonprofit_collaborations Boolean        @default(false)
  created_at               DateTime       @default(now())
  updated_at               DateTime       @updatedAt
  startup_profile          StartupProfile @relation(fields: [startup_profile_id], references: [id], onDelete: Cascade)

  @@map("partnership_interests")
}

model InnovationFocus {
  id                        Int            @id @default(autoincrement())
  startup_profile_id        Int            @unique
  product_development       Boolean        @default(false)
  process_innovation        Boolean        @default(false)
  business_model_innovation Boolean        @default(false)
  sustainability_innovation Boolean        @default(false)
  social_impact             Boolean        @default(false)
  disruptive_technology     Boolean        @default(false)
  created_at                DateTime       @default(now())
  updated_at                DateTime       @updatedAt
  startup_profile           StartupProfile @relation(fields: [startup_profile_id], references: [id], onDelete: Cascade)

  @@map("innovation_focus")
}

// Main model linking to a User (assuming a User model exists)
model StudentProfile {
  id                      Int                 @id @default(autoincrement())
  user_id                 Int                 @unique // Link to the main User model (User in the User model)
  is_complete             Boolean             @default(false)
  completion_percentage   Int                 @default(0)
  created_at              DateTime            @default(now())
  updated_at              DateTime            @updatedAt

  // Relationships to sub-sections
  personal_info           StudentPersonalInfo?
  education_records       EducationRecord[]    // One-to-many for multiple degrees/qualifications
  work_experiences        WorkExperience[]     // One-to-many for multiple jobs/internships
  skills_info             StudentSkills?
  user                    User                @relation(fields: [user_id], references: [id], onDelete: Cascade) // Uncomment //this if User model is defined

  @@map("student_profiles")
}

// --- Personal Info Section (image_dacf1c.png) ---
model StudentPersonalInfo {
  id                      Int                 @id @default(autoincrement())
  student_profile_id      Int                 @unique
  first_name              String
  last_name               String?
  profile_picture         String?       // Stores the S3 Public URL
  profile_picture_key     String?       // Stores the S3 Key (for deletion/cleanup)
  headline                String?             // Professional Title
  phone                   String
  gender                  String?
  date_of_birth           DateTime?
  location                String              // City, State, Country
  // email (Assuming this comes from the main User model)

  created_at              DateTime            @default(now())
  updated_at              DateTime            @updatedAt
  student_profile         StudentProfile      @relation(fields: [student_profile_id], references: [id], onDelete: Cascade)

  @@map("student_personal_info")
}

// --- Education Section (image_dad1c6.png) ---
// Using a one-to-many relationship (StudentProfile -> EducationRecord[]) 
// to allow a student to list multiple educational entries.
model EducationRecord {
  id                      Int                 @id @default(autoincrement())
  student_profile_id      Int
  institution_name        String
  degree_qualification    String
  field_of_study          String
  grade_cgpa              String?             // Grade/CGPA/CQPA
  start_date              DateTime
  end_date                DateTime?           // Nullable if "Present"

  created_at              DateTime            @default(now())
  updated_at              DateTime            @updatedAt
  student_profile         StudentProfile      @relation(fields: [student_profile_id], references: [id], onDelete: Cascade)

  @@map("student_education_records")
}

// --- Work Experience Section (image_dad1e4.png) ---
// Using a one-to-many relationship (StudentProfile -> WorkExperience[]) 
// to allow a student to list multiple experiences.
model WorkExperience {
  id                      Int                 @id @default(autoincrement())
  student_profile_id      Int
  company_name            String
  job_title               String
  start_date              DateTime
  end_date                DateTime?           // Nullable if "Present"
  location                String
  description             String?             // Max 150 words

  created_at              DateTime            @default(now())
  updated_at              DateTime            @updatedAt
  student_profile         StudentProfile      @relation(fields: [student_profile_id], references: [id], onDelete: Cascade)

  @@map("student_work_experiences")
}

// --- Skills Section (image_dad203.png) ---
model StudentSkills {
  id                      Int                 @id @default(autoincrement())
  student_profile_id      Int                 @unique
  
  // Storing selected skills as an array of strings (names of the skills)
  selected_skills         String[]            @default([])
  
  // Optional: A separate model for more detailed certificate records
  certificates            CertificateRecord[]

  created_at              DateTime            @default(now())
  updated_at              DateTime            @updatedAt
  student_profile         StudentProfile      @relation(fields: [student_profile_id], references: [id], onDelete: Cascade)

  @@map("student_skills")
}

// --- Certificate Details (Linked to StudentSkills) ---
model CertificateRecord {
  id                      Int                 @id @default(autoincrement())
  student_skills_id       Int
  certificate_name        String
  issuing_organization    String?
  issue_date              DateTime?
  credential_id           String?
  credential_url          String?
  
  created_at              DateTime            @default(now())
  updated_at              DateTime            @updatedAt
  
  skills_info             StudentSkills       @relation(fields: [student_skills_id], references: [id], onDelete: Cascade)

  @@map("certificate_records")
}


model Session {
  id            Int            @id @default(autoincrement())
  type          SessionType
  title         String
  dateTime      DateTime
  duration      String
  notifications Notification[]

  // Common
  registrationLink String?

  // Webinar-specific
  audience     String[]
  description  String?
  speakerName  String?
  speakerEmail String?
  contactInfo  String?

  // Panel Discussion-specific
  panelistName         String?
  panelistDesignation  String?
  panelistBio          String?
  moderatorName        String?
  moderatorDesignation String?
  moderatorBio         String?

  // Product Demo-specific
  presenterName        String?
  presenterDesignation String?
  presenterAffiliation String?
  aboutCompany         String?
  aboutProduct         String?

  // Relation to User
  userId Int
  user   User @relation(fields: [userId], references: [id], onDelete: Cascade)

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
}

enum NeedType {
  LIVE_PROJECTS
  INTERNSHIP
  RESEARCH
  CSR_INITIATIVE
}

model Need {
  id            Int            @id @default(autoincrement())
  user_id       Int
  type          NeedType
  title         String
  description   String
  image_url     String?
  contact_info  Json // Stores email, phone as JSON
  details_json  Json // Stores all form-specific data as JSON
  location      String?
  duration      String?
  skills        String?
  compensation  String?
  is_published  Boolean        @default(true)
  created_at    DateTime       @default(now())
  updated_at    DateTime       @updatedAt
  notifications Notification[]

  // Relations
  user User @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("needs")
}

model Notification {
  id        Int      @id @default(autoincrement())
  userId    Int // The user who receives the notification
  message   String
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())

  // Optional links to specific content
  postId    Int?
  sessionId Int?
  needId    Int?

  // Relations
  user    User     @relation(fields: [userId], references: [id])
  post    Post?    @relation(fields: [postId], references: [id])
  session Session? @relation(fields: [sessionId], references: [id])
  need    Need?    @relation(fields: [needId], references: [id])

  @@index([userId, isRead])
  @@map("notifications")
}

model ResourceFile {
  id         Int              @id @default(autoincrement())
  title      String
  fileName   String
  url        String // This will store the public URL
  category   ResourceCategory @relation(fields: [categoryId], references: [id])
  categoryId Int
  createdAt  DateTime         @default(now())
}

model ResourceCategory {
  id    Int            @id @default(autoincrement())
  title String         @unique
  files ResourceFile[]
}

model FundingSubmission {
  id        Int      @id @default(autoincrement())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    Int
  fileName  String
  filePath  String
  status    String   @default("SUBMITTED")
  createdAt DateTime @default(now())

  @@index([userId]) // Add an index for faster lookups by user
  @@map("funding_submissions") // Optional: Define the table name explicitly
}
